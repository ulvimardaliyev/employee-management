<!DOCTYPE html>
<html lang="en">
<head>
    <script
            src="https://code.jquery.com/jquery-3.6.0.js"
            integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
            crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/static/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <script src="/static/main.js"></script>
    <title>Index</title>
</head>
<body>
<div class="container">
    <div class="row row-cols-4">
        <div class="col">
            <div id="panel1" class="panel panel-primary">
                <div class="panel-heading">
                    #panel1
                </div>
                <div class="panel-body">
                    content
                    <div>
                        <ul class="dropdown ">
                            <li class="telefon">
                                <a href>Menu</a>
                                <ul>
                                    <li class="dropdown-content">
                                        <button type="button" id="getAllEmp">
                                            Click me
                                        </button>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="col">
            <div id="panel2" class="panel panel-primary">
                <div class="panel-heading">
                    #panel2
                </div>
                <div class="panel-body">
                    content
                </div>
            </div>
        </div>
        <div class="col">
            <div id="panel3" class="panel panel-primary">
                <div class="panel-heading">
                    #panel3
                </div>
                <div class="panel-body" id="main-table" style="display: none">
                    <!-- <ul id="employee">-->
                    <div>
                        <h4>Delete Employee</h4>
                    </div>
                    <button id="btn"><h4>Add Employee</h4></button>

                    <div class="modal" id="modalforemp">
                        <div class="model-content">
                            <span class="close">&times;</span>

                            <ol>
                                <li>
                                    <label for="name" style="color: red">Name</label>
                                    <input type="text" id="name" name="name">
                                </li>
                                <li>
                                    <label for="surname" style="color: red">Surname</label>
                                    <input type="text" id="surname" name="surname">
                                </li>
                                <li>
                                    <label for="fatherName" style="color: red">FatherName</label>
                                    <input type="text" id="fatherName" name="fatherName">
                                </li>
                                <li>
                                    <label for="birthday" style="color:red;">Birthday</label>
                                    <input type="text" id="birthday" name="birthday">
                                </li>
                                <li>
                                    <label for="position" style="color:red;">Position</label>
                                    <input type="text" id="position" name="position">
                                </li>
                                <li>
                                    <label for="finCode" style="color: red">FinCode</label>
                                    <input type="text" id="finCode" name="finCode">
                                </li>
                                <button id="add-employee">Add!</button>
                            </ol>
                        </div>
                    </div>
                    <table class="dt-checkboxes" id="table1">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Name</th>
                            <th>Surname</th>
                            <th>FatherName</th>
                            <th>Birthday</th>
                            <th>Position</th>
                            <th>FinCode</th>
                        </tr>
                        </thead>
                        <tbody id="employee-table">
                        <input id="btnGet" type="button" value="Get Selected"/>
                        </tbody>

                    </table>
                    <!--</ul>-->
                    <ul id="error-name" style="display: none">
                        Error Occurred, be sure your request to API is correct
                    </ul>

                </div>
            </div>
        </div>
        <div class="col">
            <div id="panel4" class="panel panel-primary">
                <div class="panel-heading">
                    #panel4
                </div>
                <div class="panel-body">

                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var $employees = $('#employee-table');
    var $maintable = $('#main-table');
    $('#getAllEmp').on('click', function () {
        if ($maintable.css('display') == 'none') {
            $maintable.show();
        }
        $(function () {
            $.ajax(
                {
                    type: 'GET',
                    url: '/api/users',
                    success: function (employees) {
                        $.each(employees, function (index, employee) {
                            $employees.append('<tr>' + '<td><input type="checkbox"></td>' + '<td style="display: none">' + employee.user_id + '</td>' + '<td>' + employee.name + '</td>' + '<td>' + employee.surname + '</td>' + '<td>' + employee.fatherName + '</td>' +
                                '<td>' + employee.birthday + '</td>' + '<td>' + employee.position + '</td>' + '<td>' + employee.finCode + '</td>' + '</tr>')
                        })
                    },//'<td id="hiddenid"><span  <!--style="display: none"-->>' + employee.user_id + '</span></td>' +
                    error: function () {
                        var $errorMessage = $('#error-name');
                        $errorMessage.show();
                    }
                }
            )
        });
    });

    var $empName = $('#name');
    var $surname = $('#surname');
    var $fatherName = $('#fatherName');
    var $birthday = $('#birthday');
    var $position = $('#position');
    var $finCode = $('#finCode');

    $('#add-employee').on('click', function () {
        var employee = {
            name: $empName.val(),
            surname: $surname.val(),
            fatherName: $fatherName.val(),
            birthday: $birthday.val(),
            position: $position.val(),
            finCode: $finCode.val(),
        };
        $.ajax(
            {
                type: 'POST',
                url: '/api/users',
                data: JSON.stringify(employee),
                dataType: 'json',
                contentType: 'application/json',
                success: function (newEmployee) {
                    $employees.append('<tr>' + '<td><input type="checkbox"></td>' + '<td style="display: none">' + employee.user_id + '</td>' + '<td>' + newEmployee.name + '</td>' + '<td>' + newEmployee.surname + '</td>' + '<td>' + newEmployee.fatherName + '</td>' +
                        '<td>' + newEmployee.birthday + '</td>' + '<td>' + newEmployee.position + '</td>' + '<td>' + newEmployee.finCode + '</td>' + '</tr>')
                }
            });
    });
    var $inputButton = $('#table1');
    var $id = $(function () {
        var message;
        $inputButton.click(function () {

            $("#table1 input[type=checkbox]:checked").each(function () {
                    var row = $(this).closest("tr")[0];
                    message += row.cells[1].innerHTML;
                    /*message += "   " + row.cells[2].innerHTML;
                    message += "   " + row.cells[3].innerHTML;
                    message += "\n";*/
                }
            );
            //alert(message);

        });
        return message;
    });
    console.log($id);
    var modal = document.getElementById("modalforemp");
    var button = document.getElementById("btn");
    var span = document.getElementsByClassName("close")[0];
    button.onclick = function () {
        modal.style.display = "block";
    }
    span.onclick = function () {
        modal.style.display = "none";
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
</body>
</html>